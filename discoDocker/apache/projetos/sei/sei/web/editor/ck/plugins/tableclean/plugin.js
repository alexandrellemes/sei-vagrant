CKEDITOR.env.ie&&9>CKEDITOR.env.version&&(Array.prototype.indexOf=function(a,d){for(var b=d||0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1});function cleanAttribute(a){var d=["width","style","moz_resizing","colspan","rowspan"];"TABLE"==a.nodeName?(d.push("class"),d.push("border")):d.push("align");var b=[];a=a.attributes;var c=a.length;if(0<c){for(var e=0;e<c;e++)-1==d.indexOf(a[e].name.toLowerCase())&&b.push(a[e].name);for(d=0;d<b.length;d++)a.removeNamedItem(b[d])}}
function cleanStyle(a){var d="width font-family font-size font-weight text-align border-spacing nowrap".split(" "),b=[];a=a.style;var c=a.length;if(CKEDITOR.env.ie&&9>CKEDITOR.env.version)if(0==a.cssText.length)c=0;else var e=a.cssText.split(";"),c=e.length;var f;if(0<c){for(var g=0;g<c;g++)e?(f=e[g].split(":")[0].toLowerCase(),-1!=d.indexOf(f)&&b.push(e[g])):(f=a[g],-1==d.indexOf(f)&&b.push(f));if(e)a.cssText=b.join(";");else for(d=0;d<b.length;d++)a.removeProperty(b[d])}}
function cleanTable(a){"TABLE"==a.nodeName&&(CKEDITOR.env.ie?cleanElement(a.children[0]):cleanElement(a.firstElementChild),cleanAttribute(a),cleanStyle(a))}
function cleanElement(a){-1!=["THEAD","TBODY","TR","TD","TH"].indexOf(a.nodeName)&&(cleanAttribute(a),cleanStyle(a),CKEDITOR.env.ie?(null!=a.children[0]&&cleanElement(a.children[0]),null!=a.nextSibling&&cleanElement(a.nextSibling)):(null!=a.firstElementChild&&cleanElement(a.firstElementChild),null!=a.nextElementSibling&&cleanElement(a.nextElementSibling)))}
CKEDITOR.plugins.add("tableclean",{requires:["table"],init:function(a){a.addCommand("tableClearFormat",{exec:function(a){a=a.getSelection();var b=a.getRanges(),c=null;(c=a.getSelectedElement())?c=c.getAscendant("table",!0):0<b.length&&(CKEDITOR.env.webkit&&b[0].shrink(CKEDITOR.NODE_ELEMENT),c=b[0].getCommonAncestor(!0).getAscendant("table",!0));this._.selectedElement=c;cleanTable(c.$);c.setAttribute("border","1");c.removeClass("cke_show_border")}});a.addMenuItems&&a.addMenuItems({tableclean:{label:"Limpar Formatação",
command:"tableClearFormat",group:"table",order:4}});a.contextMenu&&a.contextMenu.addListener(function(a,b){return!a||a.isReadOnly()?null:a.hasAscendant("table",1)?{tableclean:CKEDITOR.TRISTATE_OFF}:null})}});